{"version":3,"file":"StreetView.js","sources":["StreetView.js"],"names":["define","declare","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","lang","aspect","topic","GraphicsLayer","Graphic","SimpleRenderer","template","PictureMarkerSymbol","domStyle","Point","SpatialReference","MenuItem","proj4","i18n","widgetsInTemplate","templateString","mapClickMode","panoOptions","addressControlOptions","position","google","maps","ControlPosition","TOP_RIGHT","linksControl","panControl","zoomControlOptions","style","ZoomControlStyle","SMALL","enableCloseButton","proj4BaseURL","proj4Catalog","projCustomURL","postCreate","this","inherited","arguments","createGraphicsLayer","map","on","hitch","own","subscribe","parentWidget","toggleable","after","onLayoutChange","open","panorama","event","trigger","window","Proj4js","mapRightClickMenu","addRightClickMenu","pointSymbol","require","toUrl","pointGraphics","id","title","pointRenderer","label","description","setRenderer","addLayer","evt","mapRightClickPoint","mapPoint","addChild","rightClickMenuItem","onClick","onOpen","show","panoramaService","StreetViewPanorama","panoNode","StreetViewService","onClose","hide","connectMapClick","placePoint","disconnectMapClick","setMapCursor","publish","clearGraphics","clear","set","noStreetViewResults","enableStreetViewClick","disableStreetViewClick","getStreetView","overRide","toggle","geometry","wkid","spatialReference","key","defs","url","proj4CustomURL","toLowerCase","projPoint","inverse","x","y","loadingStreetView","getPanoramaLocation","setPanoPlace","geoPoint","place","LatLng","getPanoramaByLocation","addListener","getPanoramaByLocationComplete","StreetViewPanoramaData","StreetViewStatus","firstSet","setPosition","source","error","setPlaceMarkerPosition","placeMarker","graphics","length","add","panoPosition","getPosition","positionLat","lat","positionLong","lng","isNaN","xy","forward","point","setGeometry","heading","spherical","computeHeading","setPov","pitch","setTimeout","setPlaceMarkerRotation","pov","getPov","setAngle","refresh","streetViewFromMapRightClick","setMapClickMode","mode"],"mappings":";;;;;AAEAA,QACC,qBACA,oBACA,wBACA,gCACA,kBACA,cACA,aACA,4BACA,eACA,gCACA,mDACA,mCACA,iBACA,sBACA,wBACA,iBACA,0DACA,sCAEA,oBACA,6CACA,oEACE,SAAUC,EAASC,EAAaC,EAAiBC,EAAyBC,EAAMC,EAAQC,EAAOC,EAAeC,EAASC,EAAgBC,EAAUC,EAAqBC,EAAUC,EAAOC,EAAkBC,EAAUC,EAAOC,GAE5N,MAAOjB,IAASC,EAAaC,EAAiBC,IAC7Ce,mBAAmB,EACnBC,eAAgBT,EAChBO,KAAMA,EACNG,aAAc,KAEdC,aACCC,uBACCC,SAAUC,OAAOC,KAAKC,gBAAgBC,WAEvCC,cAAc,EACdC,YAAY,EACZC,oBACCC,MAAOP,OAAOC,KAAKO,iBAAiBC,OAErCC,mBAAmB,GAIpBC,aAAc,+BAIdC,aAAc,OAKdC,cAAe,KAEfC,WAAY,WACXC,KAAKC,UAAUC,WACfF,KAAKG,sBACLH,KAAKI,IAAIC,GAAG,QAASxC,EAAKyC,MAAMN,KAAM,kBAEtCA,KAAKO,IAAIxC,EAAMyC,UAAU,0BAA2B3C,EAAKyC,MAAMN,KAAM,qBAEjEA,KAAKS,eACJT,KAAKS,aAAaC,YACrBV,KAAKO,IAAIzC,EAAO6C,MAAMX,KAAKS,aAAc,SAAU5C,EAAKyC,MAAMN,KAAM,WACnEA,KAAKY,eAAeZ,KAAKS,aAAaI,UAGxCb,KAAKO,IAAIzC,EAAO6C,MAAMX,KAAKS,aAAc,SAAU5C,EAAKyC,MAAMN,KAAM,WAC/DA,KAAKc,UACR7B,OAAOC,KAAK6B,MAAMC,QAAQhB,KAAKc,SAAU,eAQ5CG,OAAOC,QAAUzC,EAEbuB,KAAKmB,mBACRnB,KAAKoB,qBAGPjB,oBAAqB,WACpBH,KAAKqB,YAAc,GAAIjD,GAAoBkD,QAAQC,MAAM,6CAA8C,GAAI,IAC3GvB,KAAKwB,cAAgB,GAAIxD,IACxByD,GAAI,sBACJC,MAAO,gBAER1B,KAAK2B,cAAgB,GAAIzD,GAAe8B,KAAKqB,aAC7CrB,KAAK2B,cAAcC,MAAQ,cAC3B5B,KAAK2B,cAAcE,YAAc,cACjC7B,KAAKwB,cAAcM,YAAY9B,KAAK2B,eACpC3B,KAAKI,IAAI2B,SAAS/B,KAAKwB,gBAExBJ,kBAAmB,WAClBpB,KAAKI,IAAIC,GAAG,YAAaxC,EAAKyC,MAAMN,KAAM,SAAUgC,GACnDhC,KAAKiC,mBAAqBD,EAAIE,YAE/BlC,KAAKmB,kBAAkBgB,SAAS,GAAI3D,IACnCoD,MAAO5B,KAAKtB,KAAK0D,mBAAmBR,MACpCS,QAASxE,EAAKyC,MAAMN,KAAM,mCAG5BsC,OAAQ,WACPtC,KAAKwB,cAAce,OACdvC,KAAKc,UAAad,KAAKwC,kBAC3BxC,KAAKc,SAAW,GAAI7B,QAAOC,KAAKuD,mBAAmBzC,KAAK0C,SAAU1C,KAAKlB,aACvEkB,KAAKwC,gBAAkB,GAAIvD,QAAOC,KAAKyD,mBAEpC3C,KAAKc,UACR7B,OAAOC,KAAK6B,MAAMC,QAAQhB,KAAKc,SAAU,WAG3C8B,QAAS,WAER5C,KAAKwB,cAAcqB,OACO,eAAtB7C,KAAKnB,cACRmB,KAAK8C,mBAGPlC,eAAgB,SAAUC,GACrBA,EACHb,KAAKsC,SAELtC,KAAK4C,WAGPG,WAAY,WACX/C,KAAKgD,sBAGNA,mBAAoB,WACnBhD,KAAKI,IAAI6C,aAAa,aACtBlF,EAAMmF,QAAQ,0BAA2B,eAE1CJ,gBAAiB,WAChB9C,KAAKI,IAAI6C,aAAa,QACtBlF,EAAMmF,QAAQ,4BAEfC,cAAe,WACdnD,KAAKwB,cAAc4B,QACnB/E,EAASgF,IAAIrD,KAAKsD,oBAAqB,UAAW,UAEnDC,sBAAuB,WACtBvD,KAAKgD,sBAENQ,uBAAwB,WACvBxD,KAAK8C,mBAENW,cAAe,SAAUzB,EAAK0B,GAC7B,GAA0B,eAAtB1D,KAAKnB,cAAiC6E,EAAU,CACnD,GAAIxB,GAAWF,EAAIE,QACnB,KAAKA,EACJ,MAGGlC,MAAKS,eAAiBT,KAAKS,aAAaI,MAC3Cb,KAAKS,aAAakD,QAInB,IAAIC,GAAW,KACdC,EAAO3B,EAAS4B,iBAAiBD,IACrB,UAATA,IACHA,EAAO,KAER,IAAIE,GAAM/D,KAAKH,aAAe,IAAMgE,CACpC,KAAKpF,EAAMuF,KAAKD,GAAM,CACrB,GAAIE,GAAMjE,KAAKkE,gBAAkBlE,KAAKJ,aAAe,OAASI,KAAKH,aAAasE,cAAgB,IAAMN,EAAO,WAE7G,YADAvC,UAAS2C,GAAMpG,EAAKyC,MAAMN,KAAM,gBAAiBgC,GAAK,IAKvD,GAAIoC,GAAY3F,EAAMA,EAAMuF,KAAKD,IAAMM,SAASnC,EAASoC,EAAGpC,EAASqC,GACjEH,KACHR,GACCU,EAAGF,EAAU,GACbG,EAAGH,EAAU,KAIXR,GACHvF,EAASgF,IAAIrD,KAAKsD,oBAAqB,UAAW,QAClDjF,EAASgF,IAAIrD,KAAKwE,kBAAmB,UAAW,gBAChDxE,KAAKyE,oBAAoBb,KAEzB5D,KAAK0E,aAAe,KACpB1E,KAAKmD,gBACL9E,EAASgF,IAAIrD,KAAKsD,oBAAqB,UAAW,YAKrDmB,oBAAqB,SAAUE,GAC9B,GAAIC,GAAQ,GAAI3F,QAAOC,KAAK2F,OAAOF,EAASJ,EAAGI,EAASL,EACxDtE,MAAKwC,gBAAgBsC,sBAAsBF,EAAO,GAAI/G,EAAKyC,MAAMN,KAAM,gCAAiC2E,IAExG1F,OAAOC,KAAK6B,MAAMgE,YAAY/E,KAAKc,SAAU,mBAAoBjD,EAAKyC,MAAMN,KAAM,2BAElFf,OAAOC,KAAK6B,MAAMgE,YAAY/E,KAAKc,SAAU,cAAejD,EAAKyC,MAAMN,KAAM,4BAE9EgF,8BAA+B,SAAUL,EAAUM,EAAwBC,GAE1E,GADA7G,EAASgF,IAAIrD,KAAKwE,kBAAmB,UAAW,QACvB,OAArBU,EAA2B,CAC9BlF,KAAKwD,wBACL,IAAIoB,GAAQ,GAAI3F,QAAOC,KAAK2F,OAAOF,EAASJ,EAAGI,EAASL,EACxDtE,MAAK0E,aAAeE,EACpB5E,KAAKmF,UAAW,EAChBnF,KAAKc,SAASsE,YAAYR,OACK,iBAArBM,GACVlF,KAAK0E,aAAe,KACpB1E,KAAKmD,gBAELnD,KAAK8C,kBACLzE,EAASgF,IAAIrD,KAAKsD,oBAAqB,UAAW,WAElDtD,KAAK0E,aAAe,KACpB1E,KAAKmD,gBACLpF,EAAMmF,QAAQ,sBACbmC,OAAQ,aACRC,MAAO,eAIVC,uBAAwB,WAClBvF,KAAKwF,aAAsD,IAAvCxF,KAAKwB,cAAciE,SAASC,SACpD1F,KAAKwF,YAAc,GAAIvH,GAEvB+B,KAAKwB,cAAcmE,IAAI3F,KAAKwF,aAG7B,IAAII,GAAe5F,KAAKc,SAAS+E,cAC7BC,EAAcF,EAAaG,MAC3BC,EAAeJ,EAAaK,KAEhC,KAAKC,MAAMJ,KAAiBI,MAAMF,GAAe,CAEhD,GAAIG,GAAK,KACRtC,EAAO7D,KAAKI,IAAI0D,iBAAiBD,IACrB,UAATA,IACHA,EAAO,KAER,IAAIE,GAAM/D,KAAKH,aAAe,IAAMgE,CACpC,KAAKpF,EAAMuF,KAAKD,GAAM,CACrB,GAAIE,GAAMjE,KAAKkE,gBAAkBlE,KAAKJ,aAAe,OAASI,KAAKH,aAAasE,cAAgB,IAAMN,EAAO,WAE7G,YADAvC,UAAS2C,GAAMpG,EAAKyC,MAAMN,KAAM,2BAMjC,GADAmG,EAAK1H,EAAMA,EAAMuF,KAAKD,IAAMqC,SAASJ,EAAcF,IAC3C,CACP,GAAIO,GAAQ,GAAI/H,GAAM6H,EAAI,GAAI5H,IAC7BsF,KAAMA,IAKP,IADA7D,KAAKwF,YAAYc,YAAYD,GACzBrG,KAAK0E,eAAiB1E,KAAKmF,SAAU,CACxC,GAAIoB,GAAUtH,OAAOC,KAAK0E,SAAS4C,UAAUC,eAAeb,EAAc5F,KAAK0E,aAC/E1E,MAAKc,SAAS4F,QACbH,QAASA,EACTI,MAAO,IAERC,WAAW/I,EAAKyC,MAAMN,KAAM,WAC3BA,KAAK0E,aAAe,OACjB,SAEJ1E,MAAKmF,UAAW,KAKpB0B,uBAAwB,WACvB,GAAI7G,KAAKwF,YAAa,CACrB,GAAIsB,GAAM9G,KAAKc,SAASiG,QACxB/G,MAAKqB,YAAY2F,SAASF,EAAIP,SAC9BvG,KAAKwB,cAAcyF,YAGrBC,4BAA6B,WAC5B,GAAIlF,IACHE,SAAUlC,KAAKiC,mBAEhBjC,MAAKyD,cAAczB,GAAK,IAEzBmF,gBAAiB,SAAUC,GAC1BpH,KAAKnB,aAAeuI","sourcesContent":["/*global google */\n/*jshint unused:true */\ndefine([\n\t'dojo/_base/declare',\n\t'dijit/_WidgetBase',\n\t'dijit/_TemplatedMixin',\n\t'dijit/_WidgetsInTemplateMixin',\n\t'dojo/_base/lang',\n\t'dojo/aspect',\n\t'dojo/topic',\n\t'esri/layers/GraphicsLayer',\n\t'esri/graphic',\n\t'esri/renderers/SimpleRenderer',\n\t'dojo/text!./StreetView/templates/StreetView.html',\n\t'esri/symbols/PictureMarkerSymbol',\n\t'dojo/dom-style',\n\t'esri/geometry/Point',\n\t'esri/SpatialReference',\n\t'dijit/MenuItem',\n\t'//cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.3/proj4.js',\n\t'dojo/i18n!./StreetView/nls/resource',\n\n\t'dijit/form/Button',\n\t'xstyle/css!./StreetView/css/StreetView.css',\n\t'gis/plugins/async!//maps.google.com/maps/api/js?v=3&sensor=false'\n], function (declare, _WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin, lang, aspect, topic, GraphicsLayer, Graphic, SimpleRenderer, template, PictureMarkerSymbol, domStyle, Point, SpatialReference, MenuItem, proj4, i18n) {\n\n\treturn declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], {\n\t\twidgetsInTemplate: true,\n\t\ttemplateString: template,\n\t\ti18n: i18n,\n\t\tmapClickMode: null,\n\n\t\tpanoOptions: {\n\t\t\taddressControlOptions: {\n\t\t\t\tposition: google.maps.ControlPosition.TOP_RIGHT\n\t\t\t},\n\t\t\tlinksControl: false,\n\t\t\tpanControl: false,\n\t\t\tzoomControlOptions: {\n\t\t\t\tstyle: google.maps.ZoomControlStyle.SMALL\n\t\t\t},\n\t\t\tenableCloseButton: false\n\t\t},\n\n\t\t// in case this changes some day\n\t\tproj4BaseURL: 'http://spatialreference.org/',\n\n\t\t//  options are ESRI, EPSG and SR-ORG\n\t\t// See http://spatialreference.org/ for more information\n\t\tproj4Catalog: 'EPSG',\n\n\t\t// if desired, you can load a projection file from your server\n\t\t// instead of using one from spatialreference.org\n\t\t// i.e., http://server/projections/102642.js\n\t\tprojCustomURL: null,\n\n\t\tpostCreate: function () {\n\t\t\tthis.inherited(arguments);\n\t\t\tthis.createGraphicsLayer();\n\t\t\tthis.map.on('click', lang.hitch(this, 'getStreetView'));\n\n\t\t\tthis.own(topic.subscribe('mapClickMode/currentSet', lang.hitch(this, 'setMapClickMode')));\n\n\t\t\tif (this.parentWidget) {\n\t\t\t\tif (this.parentWidget.toggleable) {\n\t\t\t\t\tthis.own(aspect.after(this.parentWidget, 'toggle', lang.hitch(this, function () {\n\t\t\t\t\t\tthis.onLayoutChange(this.parentWidget.open);\n\t\t\t\t\t})));\n\t\t\t\t}\n\t\t\t\tthis.own(aspect.after(this.parentWidget, 'resize', lang.hitch(this, function () {\n\t\t\t\t\tif (this.panorama) {\n\t\t\t\t\t\tgoogle.maps.event.trigger(this.panorama, 'resize');\n\t\t\t\t\t}\n\t\t\t\t})));\n\t\t\t}\n\n\t\t\t// spatialreference.org uses the old\n\t\t\t// Proj4js style so we need an alias\n\t\t\t// https://github.com/proj4js/proj4js/issues/23\n\t\t\twindow.Proj4js = proj4;\n\n\t\t\tif (this.mapRightClickMenu) {\n\t\t\t\tthis.addRightClickMenu();\n\t\t\t}\n\t\t},\n\t\tcreateGraphicsLayer: function () {\n\t\t\tthis.pointSymbol = new PictureMarkerSymbol(require.toUrl('gis/dijit/StreetView/images/blueArrow.png'), 30, 30);\n\t\t\tthis.pointGraphics = new GraphicsLayer({\n\t\t\t\tid: 'streetview_graphics',\n\t\t\t\ttitle: 'Street View'\n\t\t\t});\n\t\t\tthis.pointRenderer = new SimpleRenderer(this.pointSymbol);\n\t\t\tthis.pointRenderer.label = 'Street View';\n\t\t\tthis.pointRenderer.description = 'Street View';\n\t\t\tthis.pointGraphics.setRenderer(this.pointRenderer);\n\t\t\tthis.map.addLayer(this.pointGraphics);\n\t\t},\n\t\taddRightClickMenu: function () {\n\t\t\tthis.map.on('MouseDown', lang.hitch(this, function (evt) {\n\t\t\t\tthis.mapRightClickPoint = evt.mapPoint;\n\t\t\t}));\n\t\t\tthis.mapRightClickMenu.addChild(new MenuItem({\n\t\t\t\tlabel: this.i18n.rightClickMenuItem.label,\n\t\t\t\tonClick: lang.hitch(this, 'streetViewFromMapRightClick')\n\t\t\t}));\n\t\t},\n\t\tonOpen: function () {\n\t\t\tthis.pointGraphics.show();\n\t\t\tif (!this.panorama || !this.panoramaService) {\n\t\t\t\tthis.panorama = new google.maps.StreetViewPanorama(this.panoNode, this.panoOptions);\n\t\t\t\tthis.panoramaService = new google.maps.StreetViewService();\n\t\t\t}\n\t\t\tif (this.panorama) {\n\t\t\t\tgoogle.maps.event.trigger(this.panorama, 'resize');\n\t\t\t}\n\t\t},\n\t\tonClose: function () {\n\t\t\t// end streetview on close of title pane\n\t\t\tthis.pointGraphics.hide();\n\t\t\tif (this.mapClickMode === 'streetview') {\n\t\t\t\tthis.connectMapClick();\n\t\t\t}\n\t\t},\n\t\tonLayoutChange: function (open) {\n\t\t\tif (open) {\n\t\t\t\tthis.onOpen();\n\t\t\t} else {\n\t\t\t\tthis.onClose();\n\t\t\t}\n\t\t},\n\t\tplacePoint: function () {\n\t\t\tthis.disconnectMapClick();\n\t\t\t//get map click, set up listener in post create\n\t\t},\n\t\tdisconnectMapClick: function () {\n\t\t\tthis.map.setMapCursor('crosshair');\n\t\t\ttopic.publish('mapClickMode/setCurrent', 'streetview');\n\t\t},\n\t\tconnectMapClick: function () {\n\t\t\tthis.map.setMapCursor('auto');\n\t\t\ttopic.publish('mapClickMode/setDefault');\n\t\t},\n\t\tclearGraphics: function () {\n\t\t\tthis.pointGraphics.clear();\n\t\t\tdomStyle.set(this.noStreetViewResults, 'display', 'block');\n\t\t},\n\t\tenableStreetViewClick: function () {\n\t\t\tthis.disconnectMapClick();\n\t\t},\n\t\tdisableStreetViewClick: function () {\n\t\t\tthis.connectMapClick();\n\t\t},\n\t\tgetStreetView: function (evt, overRide) {\n\t\t\tif (this.mapClickMode === 'streetview' || overRide) {\n\t\t\t\tvar mapPoint = evt.mapPoint;\n\t\t\t\tif (!mapPoint) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.parentWidget && !this.parentWidget.open) {\n\t\t\t\t\tthis.parentWidget.toggle();\n\t\t\t\t}\n\n\t\t\t\t// convert the map point's coordinate system into lat/long\n\t\t\t\tvar geometry = null,\n\t\t\t\t\twkid = mapPoint.spatialReference.wkid;\n\t\t\t\tif (wkid === 102100) {\n\t\t\t\t\twkid = 3857;\n\t\t\t\t}\n\t\t\t\tvar key = this.proj4Catalog + ':' + wkid;\n\t\t\t\tif (!proj4.defs[key]) {\n\t\t\t\t\tvar url = this.proj4CustomURL || this.proj4BaseURL + 'ref/' + this.proj4Catalog.toLowerCase() + '/' + wkid + '/proj4js/';\n\t\t\t\t\trequire([url], lang.hitch(this, 'getStreetView', evt, true));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// only need one projection as we are\n\t\t\t\t// converting to WGS84 lat/long\n\t\t\t\tvar projPoint = proj4(proj4.defs[key]).inverse([mapPoint.x, mapPoint.y]);\n\t\t\t\tif (projPoint) {\n\t\t\t\t\tgeometry = {\n\t\t\t\t\t\tx: projPoint[0],\n\t\t\t\t\t\ty: projPoint[1]\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (geometry) {\n\t\t\t\t\tdomStyle.set(this.noStreetViewResults, 'display', 'none');\n\t\t\t\t\tdomStyle.set(this.loadingStreetView, 'display', 'inline-block');\n\t\t\t\t\tthis.getPanoramaLocation(geometry);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setPanoPlace = null;\n\t\t\t\t\tthis.clearGraphics();\n\t\t\t\t\tdomStyle.set(this.noStreetViewResults, 'display', 'block');\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\t\tgetPanoramaLocation: function (geoPoint) {\n\t\t\tvar place = new google.maps.LatLng(geoPoint.y, geoPoint.x);\n\t\t\tthis.panoramaService.getPanoramaByLocation(place, 50, lang.hitch(this, 'getPanoramaByLocationComplete', geoPoint));\n\t\t\t// Panorama Events -- Changed location\n\t\t\tgoogle.maps.event.addListener(this.panorama, 'position_changed', lang.hitch(this, 'setPlaceMarkerPosition'));\n\t\t\t// Panorama Events -- Changed Rotation\n\t\t\tgoogle.maps.event.addListener(this.panorama, 'pov_changed', lang.hitch(this, 'setPlaceMarkerRotation'));\n\t\t},\n\t\tgetPanoramaByLocationComplete: function (geoPoint, StreetViewPanoramaData, StreetViewStatus) {\n\t\t\tdomStyle.set(this.loadingStreetView, 'display', 'none');\n\t\t\tif (StreetViewStatus === 'OK') {\n\t\t\t\tthis.disableStreetViewClick();\n\t\t\t\tvar place = new google.maps.LatLng(geoPoint.y, geoPoint.x);\n\t\t\t\tthis.setPanoPlace = place;\n\t\t\t\tthis.firstSet = true;\n\t\t\t\tthis.panorama.setPosition(place);\n\t\t\t} else if (StreetViewStatus === 'ZERO_RESULTS') {\n\t\t\t\tthis.setPanoPlace = null;\n\t\t\t\tthis.clearGraphics();\n\t\t\t\t// reset default map click mode\n\t\t\t\tthis.connectMapClick();\n\t\t\t\tdomStyle.set(this.noStreetViewResults, 'display', 'block');\n\t\t\t} else {\n\t\t\t\tthis.setPanoPlace = null;\n\t\t\t\tthis.clearGraphics();\n\t\t\t\ttopic.publish('viewer/handleError', {\n\t\t\t\t\tsource: 'StreetView',\n\t\t\t\t\terror: 'Unknown.'\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsetPlaceMarkerPosition: function () {\n\t\t\tif (!this.placeMarker || this.pointGraphics.graphics.length === 0) {\n\t\t\t\tthis.placeMarker = new Graphic();\n\t\t\t\t// Add graphic to the map\n\t\t\t\tthis.pointGraphics.add(this.placeMarker);\n\t\t\t}\n\t\t\t// get the new lat/long from streetview\n\t\t\tvar panoPosition = this.panorama.getPosition();\n\t\t\tvar positionLat = panoPosition.lat();\n\t\t\tvar positionLong = panoPosition.lng();\n\t\t\t// Make sure they are numbers\n\t\t\tif (!isNaN(positionLat) && !isNaN(positionLong)) {\n\t\t\t\t// convert the resulting lat/long to the map's spatial reference\n\t\t\t\tvar xy = null,\n\t\t\t\t\twkid = this.map.spatialReference.wkid;\n\t\t\t\tif (wkid === 102100) {\n\t\t\t\t\twkid = 3857;\n\t\t\t\t}\n\t\t\t\tvar key = this.proj4Catalog + ':' + wkid;\n\t\t\t\tif (!proj4.defs[key]) {\n\t\t\t\t\tvar url = this.proj4CustomURL || this.proj4BaseURL + 'ref/' + this.proj4Catalog.toLowerCase() + '/' + wkid + '/proj4js/';\n\t\t\t\t\trequire([url], lang.hitch(this, 'setPlaceMarkerPosition'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// only need the one projection as we are\n\t\t\t\t// converting from WGS84 lat/long\n\t\t\t\txy = proj4(proj4.defs[key]).forward([positionLong, positionLat]);\n\t\t\t\tif (xy) {\n\t\t\t\t\tvar point = new Point(xy, new SpatialReference({\n\t\t\t\t\t\twkid: wkid\n\t\t\t\t\t}));\n\n\t\t\t\t\t// change point position on the map\n\t\t\t\t\tthis.placeMarker.setGeometry(point);\n\t\t\t\t\tif (this.setPanoPlace && !this.firstSet) {\n\t\t\t\t\t\tvar heading = google.maps.geometry.spherical.computeHeading(panoPosition, this.setPanoPlace);\n\t\t\t\t\t\tthis.panorama.setPov({\n\t\t\t\t\t\t\theading: heading,\n\t\t\t\t\t\t\tpitch: 0\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(lang.hitch(this, function () {\n\t\t\t\t\t\t\tthis.setPanoPlace = null;\n\t\t\t\t\t\t}), 1000);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.firstSet = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsetPlaceMarkerRotation: function () {\n\t\t\tif (this.placeMarker) {\n\t\t\t\tvar pov = this.panorama.getPov();\n\t\t\t\tthis.pointSymbol.setAngle(pov.heading);\n\t\t\t\tthis.pointGraphics.refresh();\n\t\t\t}\n\t\t},\n\t\tstreetViewFromMapRightClick: function () {\n\t\t\tvar evt = {\n\t\t\t\tmapPoint: this.mapRightClickPoint\n\t\t\t};\n\t\t\tthis.getStreetView(evt, true);\n\t\t},\n\t\tsetMapClickMode: function (mode) {\n\t\t\tthis.mapClickMode = mode;\n\t\t}\n\t});\n});"]}